---
layout: post
title: Formatting an SD Card for the Beagleboard(Xm,Bone) in Ubuntu 12.04
date: '2012-08-17T15:54:00-07:00'
tags:
- beagleboard
- ubuntu
- sd card
- format
- filesystem
- Angstrom
- Linux
tumblr_url: https://kevintechnology.com/post/29649230627/formatting-an-sd-card-for-the-beagleboardxmbone
---
<p>I about tore my hair out on this one. The guys who make the Angstrom distribution of Linux have a script called “mkcard.txt” (<a href="http://www.angstrom-distribution.org/demo/beagleboard/" target="_blank">http://www.angstrom-distribution.org/demo/beagleboard/</a>) which has traditionally worked for me to format an SD card properly for the Beagleboard family of single-board computers.</p>
<p>But for some reason whenever I would run it in the last month or so on either Ubuntu 10.04 or Ubuntu 12.04, I would receive the following error and the card would not be properly formatted:</p>
<blockquote>
<div>
<p>/dev/sdb2 is apparently in use by the system; will not make a filesystem</p>
</div>
</blockquote>
<p>I found a path to the solution thanks to this askubuntu.com question: <a href="http://askubuntu.com/questions/124565/mkfs-vfat-unable-to-open-dev-sdg1-device-or-resource-busy/164106#164106" target="_blank">http://askubuntu.com/questions/124565/mkfs-vfat-unable-to-open-dev-sdg1-device-or-resource-busy/164106#164106</a>.</p>
<p>There seem to be two problems. The first is that dmsetup is stealing the SD card devices.</p>
<p>The second problem is that the script calls “kpartx” to add a partition mapping of the SD card you’re using to the /dev/mapper folder. In English, this means that it will take the drive string (“/dev/sdb” in my case), mount the partitions on the drive, and create device files for them in /dev/mapper. I’m not sure why this causes the script to fail, but I’m guessing the system isn’t relinquishing control of the partition device files to the script so it can run mkfs.vfat and mke2fs on them.</p>
<p>So anyway, to make the mkcard.txt script work, first run it once (and experience the error I referenced above).</p>
<p>Then, remove the stolen devices from dmsetup by running:</p>
<blockquote>
<div>
<p>sudo dmsetup remove sdb1</p>
<p>sudo dmsetup remove sdb2</p>
</div>
</blockquote>
<p>Finally, comment out the following lines in mkcard.txt from this:</p>
<blockquote>
<p>if [ -x `which kpartx` ]; then<br/>       kpartx -a ${DRIVE}<br/>fi</p>
</blockquote>
<p>To look like this:</p>
<blockquote>
<div>
<p>#if [ -x `which kpartx` ]; then<br/>#       kpartx -a ${DRIVE}<br/>#fi</p>
</div>
</blockquote>
<p><span></span><span></span><span>And run mkcard.txt one more time, and you should be good to go!</span></p>
